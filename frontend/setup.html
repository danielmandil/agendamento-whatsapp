<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure sua Barbearia - Sistema Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-amber-50 to-orange-100 min-h-screen">
    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600 mx-auto"></div>
            <p class="mt-4 text-gray-600">Configurando sua barbearia...</p>
        </div>
    </div>

    <!-- Conte√∫do Principal -->
    <div id="mainContent" class="container mx-auto max-w-5xl p-4">
        <!-- Header com progresso -->
        <div id="headerSection" class="text-center py-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-amber-100 rounded-full mb-4">
                <svg class="w-8 h-8 text-amber-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-800">
                ‚úÇÔ∏è Configure sua Barbearia
            </h1>
            <p class="text-gray-600 mt-2">
                Setup completo em poucos passos simples
            </p>
            
            <!-- Barra de progresso -->
            <div class="mt-6 w-full bg-gray-200 rounded-full h-2 max-w-md mx-auto">
                <div id="progressBar" class="bg-amber-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500 mt-2">
                <span id="currentStep">0</span>% completado
            </p>
        </div>

        <!-- Formul√°rio -->
        <div id="formSection" class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <form id="setupForm" class="p-8 space-y-8">
                
                <!-- Informa√ß√µes B√°sicas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            Nome da Barbearia *
                        </label>
                        <input 
                            type="text" 
                            id="businessName"
                            placeholder="Barbearia Estilo Masculino"
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200"
                            required
                        >
                        <p class="text-xs text-gray-500 mt-1">Aparecer√° no link e nas mensagens</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                            Email da Barbearia *
                        </label>
                        <input 
                            type="email" 
                            id="email"
                            placeholder="contato@barbearia.com"
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200"
                            required
                        >
                        <p class="text-xs text-gray-500 mt-1">Para comunica√ß√µes e confirma√ß√µes</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                            Nome do Propriet√°rio *
                        </label>
                        <input 
                            type="text" 
                            id="proprietario"
                            placeholder="Seu nome completo"
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200"
                            required
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                            </svg>
                            WhatsApp Business *
                        </label>
                        <input 
                            type="tel" 
                            id="whatsapp"
                            placeholder="31999887766"
                            class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200"
                            required
                        >
                        <p class="text-xs text-gray-500 mt-1">Apenas n√∫meros, com DDD</p>
                    </div>
                </div>

                <!-- Endere√ßo -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        Endere√ßo (opcional)
                    </label>
                    <input 
                        type="text" 
                        id="address"
                        placeholder="Rua das Flores, 123 - Centro, Belo Horizonte"
                        class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-200"
                    >
                    <p class="text-xs text-gray-500 mt-1">Aparecer√° nas confirma√ß√µes de agendamento</p>
                </div>

                <!-- Dias de Funcionamento -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        üìÖ Quando sua barbearia funciona?
                    </label>
                    <p class="text-gray-600 mb-4">Marque os dias em que voc√™ atende clientes</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-1" class="day-checkbox" value="1" checked>
                            <span class="font-medium">Segunda</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-2" class="day-checkbox" value="2" checked>
                            <span class="font-medium">Ter√ßa</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-3" class="day-checkbox" value="3" checked>
                            <span class="font-medium">Quarta</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-4" class="day-checkbox" value="4" checked>
                            <span class="font-medium">Quinta</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-5" class="day-checkbox" value="5" checked>
                            <span class="font-medium">Sexta</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-6" class="day-checkbox" value="6" checked>
                            <span class="font-medium">S√°bado</span>
                        </label>
                        <label class="flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition day-label">
                            <input type="checkbox" id="day-0" class="day-checkbox" value="0">
                            <span class="font-medium">Domingo</span>
                        </label>
                    </div>
                    
                    <!-- Configura√ß√£o r√°pida -->
                    <div class="bg-amber-50 p-4 rounded-lg">
                        <p class="text-sm font-medium text-amber-800 mb-2">‚ö° Configura√ß√£o r√°pida:</p>
                        <div class="space-x-2">
                            <button type="button" onclick="setWorkingDays([1,2,3,4,5,6])" class="text-xs px-3 py-1 bg-amber-500 text-white rounded hover:bg-amber-600">Seg-S√°b</button>
                            <button type="button" onclick="setWorkingDays([1,2,3,4,5])" class="text-xs px-3 py-1 bg-amber-500 text-white rounded hover:bg-amber-600">Seg-Sex</button>
                            <button type="button" onclick="setWorkingDays([2,3,4,5,6])" class="text-xs px-3 py-1 bg-amber-500 text-white rounded hover:bg-amber-600">Ter-S√°b</button>
                        </div>
                    </div>
                </div>

                <!-- Hor√°rios de Funcionamento -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üåÖ Hora de abertura
                        </label>
                        <select id="openTime" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500">
                            <option value="">Selecione o hor√°rio</option>
                            <option value="6">06:00</option>
                            <option value="7">07:00</option>
                            <option value="8" selected>08:00</option>
                            <option value="9">09:00</option>
                            <option value="10">10:00</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            üåÜ Hora de fechamento
                        </label>
                        <select id="closeTime" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-amber-500">
                            <option value="">Selecione o hor√°rio</option>
                            <option value="17">17:00</option>
                            <option value="18" selected>18:00</option>
                            <option value="19">19:00</option>
                            <option value="20">20:00</option>
                            <option value="21">21:00</option>
                            <option value="22">22:00</option>
                        </select>
                    </div>
                </div>
                
                <!-- Hor√°rio de Almo√ßo -->
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <label class="flex items-center space-x-2 mb-3">
                        <input type="checkbox" id="hasLunchBreak" onchange="toggleLunchBreak()">
                        <span class="font-medium">üçΩÔ∏è Configurar pausa para almo√ßo</span>
                    </label>
                    
                    <div id="lunchBreakConfig" class="hidden grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">In√≠cio da pausa</label>
                            <select id="lunchStart" class="w-full px-3 py-2 border rounded-lg">
                                <option value="11:30">11:30</option>
                                <option value="12:00" selected>12:00</option>
                                <option value="12:30">12:30</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Fim da pausa</label>
                            <select id="lunchEnd" class="w-full px-3 py-2 border rounded-lg">
                                <option value="13:00" selected>13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Servi√ßos Padr√£o -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-4">
                        4Ô∏è‚É£ Seus servi√ßos e pre√ßos
                    </label>
                    
                    <p class="text-gray-600 mb-4">
                        Configure os servi√ßos que voc√™ oferece, quanto tempo demora cada um e o pre√ßo
                    </p>
                    
                    <div id="servicesList" class="space-y-4 mb-6">
                        <!-- Servi√ßo padr√£o - Corte -->
                        <div class="service-item p-4 border-2 border-amber-200 rounded-lg bg-amber-50">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‚úÇÔ∏è Servi√ßo</label>
                                    <input 
                                        type="text" 
                                        placeholder="Corte masculino"
                                        class="service-name w-full px-3 py-2 border rounded focus:outline-none focus:border-amber-500"
                                        value="Corte masculino"
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">‚è±Ô∏è Tempo (min)</label>
                                    <input 
                                        type="number" 
                                        min="5" 
                                        max="300"
                                        class="service-duration w-full px-3 py-2 border rounded focus:outline-none focus:border-amber-500"
                                        value="30"
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">üí∞ Pre√ßo (R$)</label>
                                    <input 
                                        type="number" 
                                        step="0.01"
                                        min="0"
                                        class="service-price w-full px-3 py-2 border rounded focus:outline-none focus:border-amber-500"
                                        value="35.00"
                                    >
                                </div>
                                <div class="flex items-end">
                                    <button 
                                        type="button"
                                        onclick="removeService(this)"
                                        class="text-red-600 hover:text-red-800 text-sm disabled:opacity-50"
                                        disabled
                                    >
                                        üóëÔ∏è Remover
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√µes para adicionar servi√ßos comuns -->
                    <div class="mb-4">
                        <p class="text-sm font-medium text-gray-700 mb-2">Adicionar servi√ßos comuns:</p>
                        <div class="flex flex-wrap gap-2">
                            <button type="button" onclick="addCommonService('Barba', 20, 25)" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">üßî Barba</button>
                            <button type="button" onclick="addCommonService('Sobrancelha', 15, 15)" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">üëÅÔ∏è Sobrancelha</button>
                            <button type="button" onclick="addCommonService('Corte + Barba', 45, 55)" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">‚úÇÔ∏èüßî Combo</button>
                            <button type="button" onclick="addCommonService('Degrad√™', 40, 40)" class="text-xs px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded">‚ú® Degrad√™</button>
                        </div>
                    </div>
                    
                    <button 
                        type="button"
                        onclick="addService()"
                        class="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-amber-400 hover:text-amber-600 transition"
                    >
                        ‚ûï Adicionar outro servi√ßo personalizado
                    </button>
                </div>

                <!-- Configura√ß√µes Avan√ßadas -->
                <div class="space-y-6">
                    <h3 class="text-lg font-semibold text-gray-800">5Ô∏è‚É£ Configura√ß√µes de agendamento</h3>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ‚è∞ Com quanto tempo de anteced√™ncia podem agendar?
                        </label>
                        <select id="minAdvanceTime" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-amber-500">
                            <option value="0">Podem agendar na hora</option>
                            <option value="1">Pelo menos 1 hora antes</option>
                            <option value="2" selected>Pelo menos 2 horas antes</option>
                            <option value="24">Pelo menos 1 dia antes</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Evita agendamentos de √∫ltima hora</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ‚è≥ Intervalo entre atendimentos
                        </label>
                        <select id="bufferTime" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-amber-500">
                            <option value="0">Sem intervalo</option>
                            <option value="5">5 minutos</option>
                            <option value="10" selected>10 minutos</option>
                            <option value="15">15 minutos</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Tempo para limpeza entre clientes</p>
                    </div>
                </div>

                <!-- Bot√£o de Submit -->
                <button 
                    type="button"
                    onclick="submitForm()"
                    id="submitBtn"
                    class="w-full bg-amber-600 hover:bg-amber-700 text-white font-medium py-4 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center text-lg"
                >
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    üöÄ Criar Sistema
                </button>
            </form>
        </div>

        <!-- Resultado -->
        <div id="result" class="hidden mt-6 bg-white rounded-lg shadow-md p-6">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">‚úÖ</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">
                    Sistema criado com sucesso!
                </h3>
                <p class="text-gray-600">
                    Sua barbearia j√° est√° pronta para receber agendamentos online
                </p>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    üîó Link para seus clientes:
                </label>
                <div class="bg-white p-3 rounded border">
                    <code id="generatedLink" class="text-blue-600 break-all"></code>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button 
                    onclick="copyLink()"
                    class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600"
                >
                    üìã Copiar Link
                </button>
                <a 
                    id="panelLink"
                    href="#"
                    target="_blank"
                    class="w-full bg-purple-500 text-white py-2 px-4 rounded-lg hover:bg-purple-600 text-center flex items-center justify-center"
                >
                    üìä Abrir Painel
                </a>
                <button 
                    onclick="testBooking()"
                    class="w-full bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600"
                >
                    üß™ Testar Agendamento
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentProgress = 0;
        let blockedDates = [];

        // Fun√ß√£o para atualizar progresso
        function updateProgress() {
            const form = document.getElementById('setupForm');
            const inputs = form.querySelectorAll('input[required], select[required]');
            const services = collectServices();
            const workingDays = collectWorkingDays();
            
            let completed = 0;
            let total = inputs.length + 2; // +2 for services and working days
            
            inputs.forEach(input => {
                if (input.value.trim()) completed++;
            });
            
            if (services.length > 0) completed++;
            if (workingDays.length > 0) completed++;
            
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('currentStep').textContent = percentage;
            
            currentProgress = percentage;
        }

        // Toggle configura√ß√£o de almo√ßo
        function toggleLunchBreak() {
            const checkbox = document.getElementById('hasLunchBreak');
            const config = document.getElementById('lunchBreakConfig');
            config.classList.toggle('hidden', !checkbox.checked);
            updateProgress();
        }

        // Configura√ß√£o r√°pida de dias
        function setWorkingDays(days) {
            document.querySelectorAll('.day-checkbox').forEach(cb => {
                cb.checked = false;
                cb.closest('.day-label').classList.remove('bg-amber-50', 'border-amber-300');
            });
            
            days.forEach(day => {
                const checkbox = document.getElementById(`day-${day}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.day-label').classList.add('bg-amber-50', 'border-amber-300');
                }
            });
            updateProgress();
        }

        // Adicionar servi√ßos comuns
        function addCommonService(name, duration, price) {
            const servicesList = document.getElementById('servicesList');
            const newService = createServiceElement(name, duration, price);
            servicesList.appendChild(newService);
            updateProgress();
        }

        function addService() {
            const servicesList = document.getElementById('servicesList');
            const newService = createServiceElement('', 30, 0);
            servicesList.appendChild(newService);
            updateProgress();
        }

        function createServiceElement(name = '', duration = 30, price = 0) {
            const newService = document.createElement('div');
            newService.className = 'service-item p-4 border rounded-lg';
            newService.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‚úÇÔ∏è Servi√ßo</label>
                        <input 
                            type="text" 
                            placeholder="Nome do servi√ßo"
                            class="service-name w-full px-3 py-2 border rounded focus:outline-none focus:border-amber-500"
                            value="${name}"
                            onchange="updateProgress()"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‚è±Ô∏è Tempo (min)</label>
                        <input 
                            type="number" 
                            min="5" 
                            max="300"
                            class="service-duration w-full px-3 py-2 border rounded focus:outline-none focus:border-amber-500"
                            value="${duration}"
                            onchange="updateProgress()"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">üí∞ Pre√ßo (R$)</label>
                        <input 
                            type="number" 
                            step="0.01"
                            min="0"
                            class="service-price w-full px-3 py-2 border rounded focus:outline-none focus:border-amber-500"
                            value="${price}"
                            onchange="updateProgress()"
                        >
                    </div>
                    <div class="flex items-end">
                        <button 
                            type="button"
                            onclick="removeService(this)"
                            class="text-red-600 hover:text-red-800 text-sm"
                        >
                            üóëÔ∏è Remover
                        </button>
                    </div>
                </div>
            `;
            return newService;
        }

        function removeService(button) {
            const serviceItem = button.closest('.service-item');
            const servicesList = document.getElementById('servicesList');
            if (servicesList.children.length > 1) {
                serviceItem.remove();
                updateProgress();
            } else {
                alert('Voc√™ precisa ter pelo menos um servi√ßo!');
            }
        }

        // Coletar dados
        function collectServices() {
            const services = [];
            document.querySelectorAll('.service-item').forEach(item => {
                const name = item.querySelector('.service-name').value.trim();
                const duration = parseInt(item.querySelector('.service-duration').value) || 30;
                const price = parseFloat(item.querySelector('.service-price').value) || 0;
                
                if (name) {
                    services.push({ name, duration, price });
                }
            });
            return services;
        }

        function collectWorkingDays() {
            const days = [];
            document.querySelectorAll('.day-checkbox:checked').forEach(checkbox => {
                days.push(parseInt(checkbox.value));
            });
            return days;
        }

        // Valida√ß√£o
        function validateForm() {
            const businessName = document.getElementById('businessName').value.trim();
            const email = document.getElementById('email').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            const proprietario = document.getElementById('proprietario').value.trim();
            const openTime = document.getElementById('openTime').value;
            const closeTime = document.getElementById('closeTime').value;
            const services = collectServices();
            const workingDays = collectWorkingDays();

            if (!businessName || !email || !whatsapp || !proprietario) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return false;
            }

            if (!/^\S+@\S+\.\S+$/.test(email)) {
                alert('Por favor, insira um email v√°lido.');
                return false;
            }

            if (!openTime || !closeTime) {
                alert('Por favor, selecione os hor√°rios de funcionamento.');
                return false;
            }

            if (workingDays.length === 0) {
                alert('Selecione pelo menos um dia de funcionamento.');
                return false;
            }

            if (services.length === 0) {
                alert('Configure pelo menos um servi√ßo.');
                return false;
            }

            return true;
        }

        // Submiss√£o do formul√°rio
        async function submitForm() {
            console.log('üöÄ INICIANDO submitForm()');
            
            if (!validateForm()) return;
            
            const services = collectServices();
            const workingDays = collectWorkingDays();
            
            const formData = {
                businessName: document.getElementById('businessName').value.trim(),
                email: document.getElementById('email').value.trim(),
                whatsapp: document.getElementById('whatsapp').value.trim(),
                address: document.getElementById('address').value.trim(),
                openTime: parseInt(document.getElementById('openTime').value),
                closeTime: parseInt(document.getElementById('closeTime').value),
                bufferTime: parseInt(document.getElementById('bufferTime').value),
                workingDays: workingDays,
                services: services,
                minAdvanceTime: parseInt(document.getElementById('minAdvanceTime').value),
                hasLunchBreak: document.getElementById('hasLunchBreak').checked,
                lunchStart: document.getElementById('hasLunchBreak').checked ? document.getElementById('lunchStart').value : null,
                lunchEnd: document.getElementById('hasLunchBreak').checked ? document.getElementById('lunchEnd').value : null
            };
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚è≥ Criando sistema...';
            
            try {
                console.log('üåê Enviando dados para /api/barbers...');
                
                const response = await fetch('/api/barbers', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                console.log('üìã Resultado:', result);

                if (result.success) {
                    console.log('‚úÖ SUCESSO!');
                    
                    document.getElementById('generatedLink').textContent = result.data.bookingUrl;
                    document.getElementById('panelLink').href = `/painel.html?slug=${result.data.slug}`;
                    
                    // Mostrar resultado e esconder formul√°rio
                    document.getElementById('result').classList.remove('hidden');
                    document.getElementById('headerSection').style.display = 'none';
                    document.getElementById('formSection').style.display = 'none';
                    
                    // Scroll para o resultado
                    document.getElementById('result').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                } else {
                    throw new Error(result.error || 'Erro desconhecido');
                }
            } catch (error) {
                console.error('üí• Erro:', error);
                alert('Erro ao criar sistema: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = `
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    üöÄ Criar Sistema
                `;
            }
        }

        // Fun√ß√µes auxiliares
        function copyLink() {
            const link = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Link copiado! üìã');
            });
        }

        function testBooking() {
            const link = document.getElementById('generatedLink').textContent;
            window.open(link, '_blank');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Esconder loading
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                updateProgress();
            }, 1000);

            // Adicionar event listeners para atualiza√ß√£o do progresso
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', updateProgress);
                input.addEventListener('input', updateProgress);
            });

            // Event listeners para checkboxes dos dias
            document.querySelectorAll('.day-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const label = this.closest('.day-label');
                    if (this.checked) {
                        label.classList.add('bg-amber-50', 'border-amber-300');
                    } else {
                        label.classList.remove('bg-amber-50', 'border-amber-300');
                    }
                    updateProgress();
                });
            });
        });
    </script>
</body>
</html>